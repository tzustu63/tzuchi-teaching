# 檔案上傳功能測試指南

## 🎯 測試目的

確保：

1. ✅ 檔案上傳功能正常運作
2. ✅ AI 能讀取並分析上傳的檔案內容
3. ✅ 課程基本資訊 + 檔案內容一起送給 AI 生成

## 📝 測試步驟

### 1. 準備測試檔案

準備一個測試檔案（PDF、Word 或 TXT），例如：

- 一個包含教案內容的 PDF 檔案
- 或者一個包含課程設計的 Word 文檔

### 2. 開始測試

1. **訪問應用程式**

   - 打開瀏覽器：http://localhost:3000
   - 選擇 AI 模型（OpenAI 或 Claude）

2. **填寫基本資訊**

   - 課程標題：親切有禮
   - 年級：一年級
   - 課程時長（分鐘）：30
   - 學生人數：20
   - 教室設備：投影機、電腦

3. **上傳檔案**（這是最重要的測試步驟）

   - 點擊「教案內容（選填）」的檔案選擇器
   - 選擇您準備的 PDF/Word/TXT 檔案
   - **檔案上傳過程會在控制台顯示**

4. **生成教學理念**
   - 點擊「下一步：生成教學理念」按鈕
   - **觀察瀏覽器控制台輸出**

## 🔍 預期的控制台輸出

### 前端控制台（瀏覽器 F12 → Console）

```
正在上傳並分析檔案...
檔案上傳成功: {status: 'success', file_path: 'uploads/...', filename: 'xxx.pdf'}
檔案內容已讀取: [檔案內容的前 300 字元]...
✅ 包含上傳的檔案內容，長度: 1234 字元
檔案內容預覽: [檔案內容]...
選擇的 AI 模型: claude
課程數據: {title: '親切有禮', grade: '一年級', ..., upload_content: '...'}
📤 發送給後端的完整數據: {...}
API 響應: {status: 'success', rationale: '...'}
```

### 後端控制台（終端機）

```
🔧 收到生成請求
  - AI 模型: claude
  - 課程標題: 親切有禮
  - 年級: 一年級
  - 時長: 30
  - 學生人數: 20
  - 教室設備: 投影機、電腦
  - ✅ 包含上傳的檔案內容，長度: 1234 字元
  - 檔案內容預覽: [前 300 字元]...
📝 開始組合 Prompt...
✅ Prompt 組合完成，長度: 2345 字元
🤖 開始調用 claude API 生成內容...
✅ 內容生成完成！
📊 生成的教學理念長度: 3456 字元
```

## ✅ 成功標準

1. **檔案上傳成功**

   - 控制台顯示「檔案上傳成功」
   - 控制台顯示「檔案內容已讀取」

2. **AI 接收完整數據**

   - 控制台顯示「✅ 包含上傳的檔案內容」
   - 後端日誌顯示「✅ 包含上傳的檔案內容」

3. **生成內容包含檔案資訊**
   - 生成的教學理念應該參考上傳的檔案內容
   - 不應該只是使用基本資訊

## 🐛 常見問題

### Q: 為什麼分析很久？

A: 如果檔案內容很長，AI 需要更多時間處理。這是正常的。

- 後端會在控制台顯示處理進度
- 可以通過日誌看到每個步驟的耗時

### Q: 如何確認檔案內容被送給了 AI？

A: 檢查控制台輸出

- 前端：顯示「✅ 包含上傳的檔案內容」
- 後端：顯示檔案內容預覽
- 兩邊都應該顯示相同的檔案內容長度

### Q: 如果上傳失敗怎麼辦？

A: 系統會自動降級

- 控制台會顯示「⚠️ 沒有上傳檔案內容」
- 但仍會使用基本資訊繼續生成
- 不會中斷流程

## 📊 測試記錄

### 測試環境

- 日期：2025-10-27
- 前端：http://localhost:3000
- 後端：http://localhost:8000
- AI 模型：Claude Sonnet 4.5 / OpenAI GPT-4o

### 測試結果

| 項目     | 結果 | 備註                       |
| -------- | ---- | -------------------------- |
| 檔案上傳 | ✅   | PDF/Word/TXT 都能正常上傳  |
| 內容解析 | ✅   | 能夠正確讀取檔案內容       |
| 數據傳遞 | ✅   | 前端正確發送給後端         |
| AI 生成  | ✅   | Claude/OpenAI 都能正常生成 |
| 內容整合 | ✅   | 生成的內容參考了檔案       |

---

**注意**：如果遇到問題，請提供控制台的完整日誌輸出，這樣可以更準確地診斷問題。
